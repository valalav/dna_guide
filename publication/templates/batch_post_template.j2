<h1>–ì–∞–ø–ª–æ–≥—Ä—É–ø–ø–∞ {{ branch_name }}</h1>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–æ–π–ª–µ—Ä–æ–≤ */
details.dna-spoiler {
    border: 1px solid #e1e4e8;
    border-radius: 6px;
    margin-bottom: 12px;
    background-color: #fff;
    overflow: hidden;
}
details.dna-spoiler summary {
    list-style: none;
    padding: 12px 16px;
    background-color: #f6f8fa;
    cursor: pointer;
    font-weight: 600;
    font-size: 15px;
    color: #24292e;
    display: flex;
    align-items: center;
    transition: background 0.2s;
    outline: none;
}
details.dna-spoiler summary:hover {
    background-color: #eef1f4;
}
details.dna-spoiler summary::-webkit-details-marker {
    display: none;
}
details.dna-spoiler summary::before {
    content: '‚ñ∂';
    font-size: 10px;
    margin-right: 12px;
    display: inline-block;
    transition: transform 0.2s;
    color: #586069;
}
details.dna-spoiler[open] summary::before {
    transform: rotate(90deg);
}
details.dna-spoiler[open] summary {
    border-bottom: 1px solid #e1e4e8;
    margin-bottom: 0;
}
.dna-spoiler-content {
    padding: 20px;
    background-color: #fff;
}
.dna-spoiler-content a {
    color: #0366d6;
    text-decoration: none;
}
.dna-spoiler-content a:hover {
    text-decoration: underline;
}
.dna-spoiler-content h1, 
.dna-spoiler-content h2, 
.dna-spoiler-content h3 {
    font-size: 1.15em !important;
    border-bottom: none !important;
    margin-top: 1em !important;
}
/* Timeline styles - diagonal layout */
.tmrca-timeline {
    position: relative;
    padding: 20px 10px;
    margin: 15px 0;
    /* Clean background */
    background: transparent;
}
/* Removed misaligned background line */
.tmrca-item {
    position: relative;
    padding: 6px 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1;
    background: white;
    border-radius: 8px;
    margin-bottom: 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}
.tmrca-item:hover {
    transform: translateX(5px);
}
.tmrca-item:hover {
    transform: translateX(5px);
}
/* Removed legacy ::before pseudo-elements to avoid double-dot issue */
.tmrca-branch {
    font-weight: 600;
    color: #1f2937;
    min-width: 100px;
}
.tmrca-branch {
    font-weight: 600;
    color: #1f2937;
    min-width: 100px;
}
.tmrca-item.major .tmrca-branch {
    color: #d97706;
    font-size: 1.1em;
}
.tmrca-item.current .tmrca-branch {
    color: #22c55e;
}
.tmrca-years {
    color: #6b7280;
    font-size: 0.85em;
    font-family: monospace;
}
.tmrca-label {
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.75em;
    margin-left: auto;
}
.tmrca-item.major .tmrca-label {
    background: #fef3c7;
    color: #92400e;
}
.tmrca-item.current .tmrca-label {
    background: #dcfce7;
    color: #166534;
}
/* Pre-major horizontal table styles */
.tmrca-pre-major {
    margin-bottom: 20px;
    overflow-x: auto;
}
.tmrca-table {
    border-collapse: collapse;
    width: 100%;
    font-size: 13px;
}
.tmrca-cell {
    border: 1px solid #e1e4e8;
    padding: 8px 12px;
    text-align: center;
    background: #f9fafb;
    min-width: 60px;
}
.tmrca-branch-name {
    font-weight: 600;
    color: #1f2937;
}
.tmrca-age {
    color: #6b7280;
    font-size: 0.85em;
    font-family: monospace;
    margin-top: 4px;
}
/* Post-major diagonal with vertical scale */
.tmrca-post-major {
    position: relative;
    display: flex;
    margin-top: 20px;
    min-height: 450px; /* Increased height again for better spacing */
}
.tmrca-scale {
    width: 60px;
    position: relative;
    border-right: 2px solid #e1e4e8;
    margin-right: 20px;
}
.tmrca-tick {
    position: absolute;
    right: 8px;
    font-size: 11px;
    color: #6b7280;
    font-family: monospace;
    transform: translateY(-50%);
}
.tmrca-tick::after {
    content: '';
    position: absolute;
    right: -10px;
    top: 50%;
    width: 8px;
    height: 1px;
    background: #e1e4e8;
}
.tmrca-timeline-diagonal {
    flex: 1;
    position: relative;
    padding: 10px 0;
}
.tmrca-item.current {
    /* Flush right for the deepest branch - strictly at bottom */
    position: absolute !important;
    right: 0 !important;
    bottom: 0 !important;
    margin: 0 !important;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 12px;
}
.tmrca-item {
    display: flex;
    align-items: center;
    gap: 8px; /* Gap between age and branch name */
}
.tmrca-age-inline {
    font-size: 13px; /* Larger font */
    color: #059669; /* Greenish tint */
    background: #ecfdf5;
    padding: 1px 6px;
    border-radius: 4px;
    font-family: monospace;
    white-space: nowrap;
    border: 1px solid #d1fae5;
}
.tmrca-deepest-age-inline {
    font-size: 15px; /* Even larger for deepest */
    font-weight: 700;
    color: #16a34a;
    background: #f0fdf4;
    padding: 3px 10px;
    border-radius: 4px;
    border: 1px solid #bbf7d0;
    white-space: nowrap;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
</style>

{{ ancestor_note }}

<p><strong>–§–∞–º–∏–ª–∏—è:</strong> {{ header.surname }}<br>
<strong>Kit Number:</strong> {{ header.kit }}<br>
<strong>–°—É–±—ç—Ç–Ω–æ—Å:</strong> {{ header.subethnos }}<br>
<strong>–ù–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç:</strong> {{ header.location }}<br>
<strong>–¢–µ—Å—Ç:</strong> {{ test_type }}</p>

<h2>–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ</h2>

<p>&nbsp;</p>

<br>

{% if test_type == 'WGS' %}
[github_md path="00_General/00_wgs.md"]
{% elif test_type == 'BigY' %}
[github_md path="00_General/00_BigY.md"]
{% elif test_type == 'y37_yseq' %}
[github_md path="00_General/00_y37_yseq.md"]
{% elif test_type == 'y37_ftdna' %}
[github_md path="00_General/00_y37_ftdna.md"]
{% elif test_type == 'genopoisk' %}
[github_md path="00_General/00_genopoisk.md"]
{% endif %}

<p><strong>–í–æ–∑—Ä–∞—Å—Ç –≤–µ—Ç–∫–∏ (TMRCA):</strong> {{ tmrca }} –ª–µ—Ç<br>
<strong>–ü—É—Ç—å:</strong> {{ formatted_lineage }}</p>

<details class="dna-spoiler">
<summary>‚è±Ô∏è –ü—É—Ç—å —Å –¥–∞—Ç–∏—Ä–æ–≤–∫–∞–º–∏ TMRCA</summary>
<div class="dna-spoiler-content">

{% if pre_major_timeline %}
<!-- Pre-major: horizontal table -->
<div class="tmrca-pre-major">
<table class="tmrca-table">
<tr>
{% for item in pre_major_timeline %}
<td class="tmrca-cell">
    <div class="tmrca-branch-name">{{ item.id }}</div>
    <div class="tmrca-age">{% if item.tmrca_formatted %}~{{ item.tmrca_formatted }}{% endif %}</div>
</td>
{% endfor %}
</tr>
</table>
</div>
{% endif %}

{% if post_major_timeline %}
<!-- Post-major: diagonal with vertical age scale -->
<div class="tmrca-post-major">
<div class="tmrca-scale">
{% for tick in age_scale_ticks %}
<div class="tmrca-tick" style="top: {{ tick.position }}%;">{{ tick.label }}</div>
{% endfor %}
</div>
<div class="tmrca-timeline-diagonal">
{% for item in post_major_timeline %}
<div class="tmrca-item{% if item.is_current %} current{% endif %}{% if item.is_major %} major{% endif %}" style="margin-left: {{ (item.position * 0.6) | int }}%; margin-top: {{ (item.position * 0.3) | int }}px;">
    {% if item.is_current %}
        <span class="tmrca-deepest-age-inline">~{{ item.tmrca_formatted }} –ª–µ—Ç</span>
    {% elif item.show_tmrca and item.tmrca_formatted %}
        <span class="tmrca-age-inline">~{{ item.tmrca_formatted }}</span>
    {% endif %}
    <span class="tmrca-branch">{{ item.id }}</span>
    {% if item.is_major %}<span class="tmrca-label">üü†</span>{% endif %}
    {% if item.is_current %}<span class="tmrca-label">üü¢</span>{% endif %}
</div>
{% endfor %}
</div>
</div>
{% endif %}

</div>
</details>

<p><a href="https://github.com/valalav/dna_guide/blob/main/02_Practical/01_YFull_Guide.md">–ö–∞–∫ —á–∏—Ç–∞—Ç—å YFull ‚Äî —ç–∫—Å–∫—É—Ä—Å–∏—è –ø–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É</a></p>

<p>&nbsp;</p>

<h2>–ò—Å—Ç–æ—Ä–∏—è</h2>

<p>{{ history_section }}</p>

<p>&nbsp;</p>

<h2>–°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>

[github_md path="00_General/00_inf.md"]


{% if y_dna_docs %}
<h3>Y-–î–ù–ö (–í–µ—Ç–∫–∏)</h3>

{% for doc in y_dna_docs|reverse %}
{% if loop.first %}
<details class="dna-spoiler" open>
<summary style="color: #0366d6;">üìç {{ doc.id }} (–≤–∞—à–∞ –≤–µ—Ç–∫–∞)</summary>
<div class="dna-spoiler-content">
[github_md path="{{ doc.path | replace('\\', '/') }}"]
</div>
</details>
{% else %}
<details class="dna-spoiler">
<summary>üìÇ {{ doc.id }} (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –≤–µ—Ç–∫–∞)</summary>
<div class="dna-spoiler-content">
[github_md path="{{ doc.path | replace('\\', '/') }}"]
</div>
</details>
{% endif %}
{% endfor %}
{% endif %}


<!-- –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π (Spoiler) -->
{% if records_count > 0 %}
<details class="dna-spoiler">
<summary>üë• –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π ({{ records_count }})</summary>
<div class="dna-spoiler-content">
<table>
<thead>
<tr><th>–§–∞–º–∏–ª–∏—è</th><th>–ò–º—è</th><th>Kit</th><th>–°—É–±—ç—Ç–Ω–æ—Å</th><th>–ù–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</th></tr>
</thead>
<tbody>
{% for rec in records %}
<tr><td>{{ rec.surname }}</td><td>{{ rec.name }}</td><td>{{ rec.kit }}</td><td>{{ rec.subethnos }}</td><td>{{ rec.location }}</td></tr>
{% endfor %}
</tbody>
</table>
</div>
</details>
{% endif %}

<!-- –°–æ—Å–µ–¥–Ω–∏–µ –≤–µ—Ç–≤–∏ (Spoiler) -->
{% if neighbor_context %}
<details class="dna-spoiler">
<summary>üå≥ –°–æ—Å–µ–¥–Ω–∏–µ –≤–µ—Ç–≤–∏ (–∏–∑ –±–∞–∑—ã AADNA)</summary>
<div class="dna-spoiler-content">
{{ neighbor_context }}
</div>
</details>
{% endif %}

<!-- STR Matches (–¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ç–µ—Å—Ç–æ–≤) -->
<details class="dna-spoiler">
<summary>üîó STR –°–æ–≤–ø–∞–¥–µ–Ω–∏—è</summary>
<div class="dna-spoiler-content">
{% if str_match_table %}
{{ str_match_table | safe }}
<p>&nbsp;</p>
{% endif %}
[github_md path="00_General/00_strmf.md"]
</div>
</details>

{% if test_type == 'WGS' %}
<!-- –ú–∏—Ç–æ—Ö–æ–Ω–¥—Ä–∏–∞–ª—å–Ω–∞—è –î–ù–ö (Spoiler) -->
<details class="dna-spoiler">
<summary>üß¨ –ú–∏—Ç–æ—Ö–æ–Ω–¥—Ä–∏–∞–ª—å–Ω–∞—è –î–ù–ö</summary>
<div class="dna-spoiler-content">
<ul>
<li><a href="https://github.com/valalav/dna_guide/blob/main/04_Women/02_mtDNA_Guide.md">02_mtDNA_Guide.md</a> (–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ mtDNA)</li>
</ul>
</div>
</details>

<!-- –ê—É—Ç–æ—Å–æ–º–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç (Spoiler) -->
<details class="dna-spoiler">
<summary>üìä –ê—É—Ç–æ—Å–æ–º–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç</summary>
<div class="dna-spoiler-content">
<ul>
<li><a href="https://github.com/valalav/dna_guide/blob/main/05_Autosomal/01_Autosomal_Guide.md">01_Autosomal_Guide.md</a> (–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ –∞—É—Ç–æ—Å–æ–º–∞–º)</li>
</ul>
</div>
</details>
{% endif %}

{% if test_type not in ['WGS', 'BigY'] %}
<!-- Nevgen Prediction -->
<details class="dna-spoiler" open>
<summary>üîÆ Nevgen Prediction (–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ)</summary>
<div class="dna-spoiler-content">
[github_md path="00_General/00_nevgen.md"]
</div>
</details>
{% endif %}

<h2>–í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏</h2>
<ul>
<li><a href="https://www.yfull.com/tree/{{ branch_id }}/">YFull Tree</a></li>
<li><a href="https://aadna.ru/">–ü—Ä–æ–µ–∫—Ç AADNA</a></li>
</ul>
